{"ast":null,"code":"var _jsxFileName = \"/Users/edisoncardenas/Downloads/repo/outletify-client/outletify-client/src/pages/Cart.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport { AuthContext } from \"../context/auth.context\";\nimport { useContext } from \"react\";\nimport ItemCard from \"../components/ItemCard\";\nimport axios from \"axios\";\nimport { useParams, Link, Navigate } from \"react-router-dom\";\nimport Swal from \"sweetalert2\";\nimport withReactContent from \"sweetalert2-react-content\";\nimport StripeCheckout from \"react-stripe-checkout\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Cart = () => {\n  _s();\n\n  var _userCart$cart, _userCart$cart2;\n\n  const {\n    isLoggedIn\n  } = useContext(AuthContext);\n  const key = \"pk_test_51M9ZjvG6NeaDtKpVRFtUgmoFVxEMaTjHtPct35DcaB1DLIyvoEqXQ6vAvcgqKcp7cfjeIs5J0ZH94EhjCsSyWN7Z00xeCRkTs7\";\n  const [userCart, setUserCart] = useState(null);\n  const {\n    userId\n  } = useParams();\n  const API_URL = \"https://codebooks.fly.dev\";\n\n  const getAllItems = () => {\n    const storedToken = localStorage.getItem(\"authToken\");\n    axios.get(`${API_URL}/auth/user/${userId}`, {\n      headers: {\n        Authorization: `Bearer ${storedToken}`\n      }\n    }).then(response => setUserCart(response.data)).catch(error => console.log(error));\n  };\n\n  useEffect(() => {\n    getAllItems();\n  }, []);\n\n  const handleClearCart = () => {\n    const storedToken = localStorage.getItem(\"userId\");\n    axios.post(`${API_URL}/auth/cart/${userId}`, {\n      headers: {\n        Authorization: `Bearer ${storedToken}`\n      }\n    }).then(response => setUserCart(response.data)).catch(error => console.log(error));\n  };\n\n  const MySwal = withReactContent(Swal);\n\n  const handleSuccess = () => {\n    MySwal.fire({\n      icon: \"success\",\n      title: \"Payment was succesful\"\n    });\n  };\n\n  const totalPrice = userCart === null || userCart === void 0 ? void 0 : (_userCart$cart = userCart.cart) === null || _userCart$cart === void 0 ? void 0 : _userCart$cart.reduce(function (acc, val) {\n    return acc + (val === null || val === void 0 ? void 0 : val.price);\n  }, 0);\n\n  const payNow = async token => {\n    try {\n      const response = await axios({\n        url: \"https://codebooks.fly.dev/auth/payment\",\n        method: \"post\",\n        data: {\n          amount: totalPrice * 100,\n          token\n        }\n      });\n\n      if (response.status === 200) {\n        await handleClearCart();\n        handleSuccess();\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: userCart ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"item-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"payment-container\",\n        children: [isLoggedIn && /*#__PURE__*/_jsxDEV(StripeCheckout, {\n          stripeKey: key,\n          label: \"Pay Now\",\n          billingAddress: true,\n          shippingAddress: true,\n          amount: totalPrice * 100,\n          description: `your total is $${totalPrice}`,\n          token: payNow\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: `total is ${totalPrice}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }, this), userCart === null || userCart === void 0 ? void 0 : (_userCart$cart2 = userCart.cart) === null || _userCart$cart2 === void 0 ? void 0 : _userCart$cart2.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"item-page\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: `/item/${item === null || item === void 0 ? void 0 : item._id}`,\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            className: \"item-name\",\n            children: item === null || item === void 0 ? void 0 : item.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            src: item === null || item === void 0 ? void 0 : item.img,\n            alt: \"pic\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: `$${item === null || item === void 0 ? void 0 : item.price}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 15\n        }, this)\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 9\n    }, this) : \"No Items In Cart\"\n  }, void 0, false);\n};\n\n_s(Cart, \"XUwO0H9SwJIV8BBGWe0+LoBEODc=\", false, function () {\n  return [useParams];\n});\n\n_c = Cart;\nexport default Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["useState","useEffect","AuthContext","useContext","ItemCard","axios","useParams","Link","Navigate","Swal","withReactContent","StripeCheckout","Cart","isLoggedIn","key","userCart","setUserCart","userId","API_URL","getAllItems","storedToken","localStorage","getItem","get","headers","Authorization","then","response","data","catch","error","console","log","handleClearCart","post","MySwal","handleSuccess","fire","icon","title","totalPrice","cart","reduce","acc","val","price","payNow","token","url","method","amount","status","map","item","index","_id","name","img"],"sources":["/Users/edisoncardenas/Downloads/repo/outletify-client/outletify-client/src/pages/Cart.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { AuthContext } from \"../context/auth.context\";\nimport { useContext } from \"react\";\nimport ItemCard from \"../components/ItemCard\";\nimport axios from \"axios\";\nimport { useParams, Link, Navigate } from \"react-router-dom\";\nimport Swal from \"sweetalert2\";\nimport withReactContent from \"sweetalert2-react-content\";\nimport StripeCheckout from \"react-stripe-checkout\";\n\nconst Cart = () => {\n  const { isLoggedIn } = useContext(AuthContext);\n  const key =\n    \"pk_test_51M9ZjvG6NeaDtKpVRFtUgmoFVxEMaTjHtPct35DcaB1DLIyvoEqXQ6vAvcgqKcp7cfjeIs5J0ZH94EhjCsSyWN7Z00xeCRkTs7\";\n\n  const [userCart, setUserCart] = useState(null);\n\n  const { userId } = useParams();\n  const API_URL = \"https://codebooks.fly.dev\";\n\n  const getAllItems = () => {\n    const storedToken = localStorage.getItem(\"authToken\");\n    axios\n      .get(`${API_URL}/auth/user/${userId}`, {\n        headers: { Authorization: `Bearer ${storedToken}` },\n      })\n      .then((response) => setUserCart(response.data))\n      .catch((error) => console.log(error));\n  };\n\n  useEffect(() => {\n    getAllItems();\n  }, []);\n\n  const handleClearCart = () => {\n    const storedToken = localStorage.getItem(\"userId\");\n    axios\n      .post(`${API_URL}/auth/cart/${userId}`, {\n        headers: { Authorization: `Bearer ${storedToken}` },\n      })\n      .then((response) => setUserCart(response.data))\n      .catch((error) => console.log(error));\n  };\n\n  const MySwal = withReactContent(Swal);\n  const handleSuccess = () => {\n    MySwal.fire({\n      icon: \"success\",\n      title: \"Payment was succesful\",\n    });\n  };\n\n  const totalPrice = userCart?.cart?.reduce(function (acc, val) {\n    return acc + val?.price;\n  }, 0);\n\n  const payNow = async (token) => {\n    try {\n      const response = await axios({\n        url: \"https://codebooks.fly.dev/auth/payment\",\n        method: \"post\",\n        data: {\n          amount: totalPrice * 100,\n          token,\n        },\n      });\n      if (response.status === 200) {\n        await handleClearCart();\n        handleSuccess();\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  return (\n    <>\n      {userCart ? (\n        <div className=\"item-container\">\n          <div className=\"payment-container\">\n            {isLoggedIn && (\n              <StripeCheckout\n                stripeKey={key}\n                label=\"Pay Now\"\n                billingAddress\n                shippingAddress\n                amount={totalPrice * 100}\n                description={`your total is $${totalPrice}`}\n                token={payNow}\n              />\n            )}\n            <p>{`total is ${totalPrice}`}</p>\n          </div>\n          {userCart?.cart?.map((item, index) => (\n            <div className=\"item-page\" key={index}>\n              <Link to={`/item/${item?._id}`}>\n                <strong className=\"item-name\">{item?.name}</strong>\n                <br />\n                <img src={item?.img} alt=\"pic\" />\n                <p>{`$${item?.price}`}</p>\n              </Link>\n            </div>\n          ))}\n        </div>\n      ) : (\n        \"No Items In Cart\"\n      )}\n    </>\n  );\n};\n\nexport default Cart;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}