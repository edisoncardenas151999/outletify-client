{"ast":null,"code":"var _jsxFileName = \"/Users/edisoncardenas/Downloads/repo/outletify-client/outletify-client/src/pages/Cart.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from \"react\";\nimport { AuthContext } from \"../context/auth.context\";\nimport { useContext } from \"react\";\nimport ItemCard from \"../components/ItemCard\";\nimport axios from \"axios\";\nimport { useParams, Link, Navigate } from \"react-router-dom\";\nimport Swal from \"sweetalert2\";\nimport withReactContent from \"sweetalert2-react-content\";\nimport StripeCheckout from \"react-stripe-checkout\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Cart = () => {\n  _s();\n\n  const {\n    user\n  } = useContext(AuthContext);\n  const userId = user === null || user === void 0 ? void 0 : user._id;\n  console.log(userId);\n  const key = \"pk_test_51M9ZjvG6NeaDtKpVRFtUgmoFVxEMaTjHtPct35DcaB1DLIyvoEqXQ6vAvcgqKcp7cfjeIs5J0ZH94EhjCsSyWN7Z00xeCRkTs7\";\n  const [cart, setCart] = useState(null);\n  const API_URL = \"https://codebooks.fly.dev\";\n\n  const getAllItems = () => {\n    const storedToken = localStorage.getItem(\"authToken\");\n    axios.get(`${API_URL}/auth/user/${userId}`, {\n      headers: {\n        Authorization: `Bearer ${storedToken}`\n      }\n    }).then(response => {\n      setCart(response.data.cart);\n    }).catch(error => console.log(error));\n  };\n\n  useEffect(() => {\n    getAllItems();\n  }, []);\n\n  const handleClearCart = () => {\n    const storedToken = localStorage.getItem(\"userId\");\n    console.log(storedToken);\n    axios.post(`${API_URL}/auth/cart/${userId}`, {\n      headers: {\n        Authorization: `Bearer ${storedToken}`\n      }\n    }).then(response => setCart(response.data.cart)).catch(error => console.log(error));\n  };\n\n  const MySwal = withReactContent(Swal);\n\n  const handleSuccess = () => {\n    MySwal.fire({\n      icon: \"success\",\n      title: \"Payment was succesful\"\n    });\n  };\n\n  const totalPrice = cart === null || cart === void 0 ? void 0 : cart.reduce(function (acc, val) {\n    return acc + (val === null || val === void 0 ? void 0 : val.price);\n  }, 0);\n\n  const payNow = async token => {\n    try {\n      const response = await axios({\n        url: \"https://codebooks.fly.dev/auth/payment\",\n        method: \"post\",\n        data: {\n          amount: totalPrice * 100,\n          token\n        }\n      });\n\n      if (response.status === 200) {\n        await handleClearCart();\n        handleSuccess();\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: cart ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"item-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"payment-container\",\n        children: [isLoggedIn && /*#__PURE__*/_jsxDEV(StripeCheckout, {\n          stripeKey: key,\n          label: \"Pay Now\",\n          billingAddress: true,\n          shippingAddress: true,\n          amount: totalPrice * 100,\n          description: `your total is $${totalPrice}`,\n          token: payNow\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: `total is ${totalPrice}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 11\n      }, this), cart === null || cart === void 0 ? void 0 : cart.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"item-page\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: `/item/${item === null || item === void 0 ? void 0 : item._id}`,\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            className: \"item-name\",\n            children: item === null || item === void 0 ? void 0 : item.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n            src: item === null || item === void 0 ? void 0 : item.img,\n            alt: \"pic\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: `$${item === null || item === void 0 ? void 0 : item.price}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 15\n        }, this)\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 9\n    }, this) : \"No Items In Cart\"\n  }, void 0, false);\n};\n\n_s(Cart, \"klj3zv4BhmFiidGbibzvSDiQDcQ=\");\n\n_c = Cart;\nexport default Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"names":["useState","useEffect","AuthContext","useContext","ItemCard","axios","useParams","Link","Navigate","Swal","withReactContent","StripeCheckout","Cart","user","userId","_id","console","log","key","cart","setCart","API_URL","getAllItems","storedToken","localStorage","getItem","get","headers","Authorization","then","response","data","catch","error","handleClearCart","post","MySwal","handleSuccess","fire","icon","title","totalPrice","reduce","acc","val","price","payNow","token","url","method","amount","status","isLoggedIn","map","item","index","name","img"],"sources":["/Users/edisoncardenas/Downloads/repo/outletify-client/outletify-client/src/pages/Cart.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { AuthContext } from \"../context/auth.context\";\nimport { useContext } from \"react\";\nimport ItemCard from \"../components/ItemCard\";\nimport axios from \"axios\";\nimport { useParams, Link, Navigate } from \"react-router-dom\";\nimport Swal from \"sweetalert2\";\nimport withReactContent from \"sweetalert2-react-content\";\nimport StripeCheckout from \"react-stripe-checkout\";\n\nconst Cart = () => {\n  const { user } = useContext(AuthContext);\n  const userId = user?._id;\n  console.log(userId);\n  const key =\n    \"pk_test_51M9ZjvG6NeaDtKpVRFtUgmoFVxEMaTjHtPct35DcaB1DLIyvoEqXQ6vAvcgqKcp7cfjeIs5J0ZH94EhjCsSyWN7Z00xeCRkTs7\";\n\n  const [cart, setCart] = useState(null);\n  const API_URL = \"https://codebooks.fly.dev\";\n\n  const getAllItems = () => {\n    const storedToken = localStorage.getItem(\"authToken\");\n    axios\n      .get(`${API_URL}/auth/user/${userId}`, {\n        headers: { Authorization: `Bearer ${storedToken}` },\n      })\n      .then((response) => {\n        setCart(response.data.cart);\n      })\n      .catch((error) => console.log(error));\n  };\n\n  useEffect(() => {\n    getAllItems();\n  }, []);\n\n  const handleClearCart = () => {\n    const storedToken = localStorage.getItem(\"userId\");\n    console.log(storedToken);\n    axios\n      .post(`${API_URL}/auth/cart/${userId}`, {\n        headers: { Authorization: `Bearer ${storedToken}` },\n      })\n      .then((response) => setCart(response.data.cart))\n      .catch((error) => console.log(error));\n  };\n\n  const MySwal = withReactContent(Swal);\n  const handleSuccess = () => {\n    MySwal.fire({\n      icon: \"success\",\n      title: \"Payment was succesful\",\n    });\n  };\n\n  const totalPrice = cart?.reduce(function (acc, val) {\n    return acc + val?.price;\n  }, 0);\n\n  const payNow = async (token) => {\n    try {\n      const response = await axios({\n        url: \"https://codebooks.fly.dev/auth/payment\",\n        method: \"post\",\n        data: {\n          amount: totalPrice * 100,\n          token,\n        },\n      });\n      if (response.status === 200) {\n        await handleClearCart();\n        handleSuccess();\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  return (\n    <>\n      {cart ? (\n        <div className=\"item-container\">\n          <div className=\"payment-container\">\n            {isLoggedIn && (\n              <StripeCheckout\n                stripeKey={key}\n                label=\"Pay Now\"\n                billingAddress\n                shippingAddress\n                amount={totalPrice * 100}\n                description={`your total is $${totalPrice}`}\n                token={payNow}\n              />\n            )}\n            <p>{`total is ${totalPrice}`}</p>\n          </div>\n          {cart?.map((item, index) => (\n            <div className=\"item-page\" key={index}>\n              <Link to={`/item/${item?._id}`}>\n                <strong className=\"item-name\">{item?.name}</strong>\n                <br />\n                <img src={item?.img} alt=\"pic\" />\n                <p>{`$${item?.price}`}</p>\n              </Link>\n            </div>\n          ))}\n        </div>\n      ) : (\n        \"No Items In Cart\"\n      )}\n    </>\n  );\n};\n\nexport default Cart;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}